<!-- recommend.ejs -->
<%- include('header.ejs') %>

<p class="lead">선택하세요</p>

<form action="/recommendProc" method="post" id="categoryForm">
  <!-- Add buttons for each category -->
  <div class="container">
    <div class="row row-cols-5">
      <% categories.forEach(category => { %>
        <div class="col mb-3">
          <button type="button" class="btn btn-outline-info category-btn rounded-3" data-category="<%= category %>">
            <span class="fs-4"><%= category %></span>
          </button>
        </div>
      <% }) %>
    </div>
  </div>

  <button type="button" class="btn btn-primary btn-lg mt-3" id="viewBtn">보기</button>

  <!-- Add a container to display selected categories -->
  <div id="selectedCategories" class="mt-3"></div>

  <!-- Add a hidden input field for selected categories -->
  <input type="hidden" name="selectedCategories" id="selectedCategoriesInput" value="">

  <style>
    .category-btn {
      width: 100%;
      height: 100%;
      min-width: 120px; /* 최소 너비 설정 */
      min-height: 150px; /* 최소 높이 설정 */
    }

    .fs-4 {
      font-size: 1.5rem;
    }
  </style>

  <script>
    // JavaScript code for handling category selection and form submission
    document.addEventListener("DOMContentLoaded", function () {
      const categoryButtons = document.querySelectorAll(".category-btn");
      const viewButton = document.getElementById("viewBtn");
      const selectedCategoriesDiv = document.getElementById("selectedCategories");
      const categoryForm = document.getElementById("categoryForm");

      let selectedCategories = [];

      // 카테고리 버튼에 이벤트 리스너 추가
      categoryButtons.forEach((button) => {
        button.addEventListener("click", function () {
          // 버튼 클릭 시 "active" 클래스 토글
          button.classList.toggle("active");

          // 선택된 카테고리 배열 업데이트
          const category = button.dataset.category;
          if (selectedCategories.includes(category)) {
            selectedCategories = selectedCategories.filter(c => c !== category);
          } else {
            // 최대 3개의 카테고리 선택 가능 여부 확인
            if (selectedCategories.length < 3) {
              selectedCategories.push(category);
          }   else {
              // 3개 이상의 카테고리가 선택되면 추가적인 선택을 막음
              alert("최대 3개의 카테고리만 선택할 수 있습니다.");
              button.classList.remove("active"); // "active" 클래스 제거
          }
        }
        });
      });

      // Add event listener to the "보기" button
      viewButton.addEventListener("click", function () {
        // Display selected categories
        selectedCategoriesDiv.innerHTML = `<p>선택된 카테고리: ${selectedCategories.join(', ')}</p>`;

        // Update the hidden input with selected categories
        document.getElementById("selectedCategoriesInput").value = selectedCategories.join(',');

        // Submit the form with selected categories
        categoryForm.submit();
      });
    });
  </script>
</form>

<%- include('footer.ejs') %>